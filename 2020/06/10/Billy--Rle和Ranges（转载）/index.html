<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><title>Rle和Ranges(转载) | Billy and Barney's Blog</title><meta name="generator" content="Hexo 4.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Rle和Ranges(转载)</h1><a id="logo" href="/.">Billy and Barney's Blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Rle和Ranges(转载)</h1><div class="post-meta"><a href="/2020/06/10/Billy--Rle%E5%92%8CRanges%EF%BC%88%E8%BD%AC%E8%BD%BD%EF%BC%89/#comments" class="comment-count"></a><p><span class="date">Jun 10, 2020</span><span><a href="/categories/R-Bioconductor/" class="category">R - Bioconductor</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>生物序列信息不仅仅指序列本身,它们还包括其他类型的信息,如基因都定位在哪些序列(染色体)上,正链还是负链,什么位置,其他数据库对应的编号是什么,有什么功能等等。下面介绍BioC中用于这些数据存储和处理的Rle和Ranges类。</p>
<h2 id="1-Rle-Run-Length-Encoding-行程编码"><a href="#1-Rle-Run-Length-Encoding-行程编码" class="headerlink" title="1. Rle(Run Length Encoding,行程编码)"></a>1. Rle(Run Length Encoding,行程编码)</h2><h3 id="1-1-Rle类和Rle对象"><a href="#1-1-Rle类和Rle对象" class="headerlink" title="1.1 Rle类和Rle对象"></a>1.1 Rle类和Rle对象</h3><p>序列或基因最终要定位到染色体上。序列往往数量非常巨大,但染色体数量很少,如果每条序列的染色体定位都显式标注,将会产生大量的重复信息,更糟糕的是它们要占用大量的内存。BioC的IRanges包为这些数据提供了一种简便可行的信息压缩方式,即Rle。如果染色体1-3分别有3000,5000和2000个基因,基因的染色体注释可以用字符向量表示,也可以用Rle对象表示:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(IRanges)  <span class="comment">##可以不执行,载入Biostrings包将自动载入依赖包IRanges</span></span><br><span class="line"><span class="keyword">library</span>(Biostrings)</span><br><span class="line">chr.str &lt;- c(rep(<span class="string">"ChrI"</span>, <span class="number">3000</span>), rep(<span class="string">"ChrII"</span>, <span class="number">5000</span>), rep(<span class="string">"ChrIII"</span>, <span class="number">2000</span>))</span><br><span class="line">chr.rle &lt;- Rle(chr.str)</span><br></pre></td></tr></table></figure>

<p>两种方式的效果是完全一样的,但是Rle对象占用空间还不到字符向量的2%:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Rle对象向量化后和原向量是完全相同的:</span></span><br><span class="line">identical(as.vector(chr.rle), chr.str)</span><br><span class="line"></span><br><span class="line"><span class="comment">## [1] TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 对象大小(内存占用)比:</span></span><br><span class="line">as.vector(object.size(chr.rle)/object.size(chr.str))</span><br></pre></td></tr></table></figure>

<p>使用Rle并不总是可以“压缩”数据。如果信息没有重复或重复量很少,Rle会占用更多的内存:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">strx.rle &lt;- Rle(strx)</span><br><span class="line">as.vector(object.size(strx.rle)/object.size(strx))</span><br><span class="line"></span><br><span class="line"><span class="comment">## [1] 1.130721</span></span><br></pre></td></tr></table></figure>

<p>Rle对象用两个属性来表示原向量,一个是值(values),可以是向量或因子;另一个是长度(lengths),为整型数据,表示对应位置的value的重复次数。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">chr.rle</span><br><span class="line"></span><br><span class="line"><span class="comment">## character-Rle of length 10000 with 3 runs</span></span><br><span class="line"><span class="comment">##   Lengths:     3000     5000     2000</span></span><br><span class="line"><span class="comment">##   Values :   "ChrI"  "ChrII" "ChrIII"</span></span><br><span class="line"></span><br><span class="line">getClass(class(chr.rle))</span><br><span class="line"></span><br><span class="line"><span class="comment">## Class "Rle" [package "S4Vectors"]</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Slots:</span></span><br><span class="line"><span class="comment">##                                                                       </span></span><br><span class="line"><span class="comment">## Name:           values         lengths elementMetadata        metadata</span></span><br><span class="line"><span class="comment">## Class:  vectorORfactor         integer DataTableORNULL            list</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Extends: </span></span><br><span class="line"><span class="comment">## Class "Vector", directly</span></span><br><span class="line"><span class="comment">## Class "Annotated", by class "Vector", distance 2</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-Rle对象的处理方法"><a href="#1-2-Rle对象的处理方法" class="headerlink" title="1.2 Rle对象的处理方法"></a>1.2 Rle对象的处理方法</h3><h4 id="1-2-1-Rle对象构建-获取"><a href="#1-2-1-Rle对象构建-获取" class="headerlink" title="1.2.1 Rle对象构建/获取:"></a>1.2.1 Rle对象构建/获取:</h4><p>Rle对象可以用构造函数Rle来产生,它有两种用法:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Rle(values)</span><br><span class="line">Rle(values, lengths)</span><br></pre></td></tr></table></figure>

<p>values和lengths均为(原子)向量。第一种用法前面已经出现过了,我们看看第二种用法:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chr.rle &lt;- Rle(values = c(<span class="string">"Chr1"</span>, <span class="string">"Chr2"</span>, <span class="string">"Chr3"</span>, <span class="string">"Chr1"</span>, <span class="string">"Chr3"</span>), lengths = c(<span class="number">3</span>,</span><br><span class="line">    <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>))</span><br><span class="line">chr.rle</span><br><span class="line"></span><br><span class="line"><span class="comment">## character-Rle of length 19 with 5 runs</span></span><br><span class="line"><span class="comment">##   Lengths:      3      2      5      4      5</span></span><br><span class="line"><span class="comment">##   Values : "Chr1" "Chr2" "Chr3" "Chr1" "Chr3"</span></span><br></pre></td></tr></table></figure>

<p>原子向量也可以通过类型转换函数as由原子向量产生,它等价于上面的第一种方式:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">as(chr.str, <span class="string">"Rle"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## character-Rle of length 10000 with 3 runs</span></span><br><span class="line"><span class="comment">##   Lengths:     3000     5000     2000</span></span><br><span class="line"><span class="comment">##   Values :   "ChrI"  "ChrII" "ChrIII"</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-获取属性"><a href="#1-2-2-获取属性" class="headerlink" title="1.2.2 获取属性:"></a>1.2.2 获取属性:</h4><p>Rle是S4类,Rle对象的属性如值、长度等可以使用属性读取函数获取:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">runLength(chr.rle)</span><br><span class="line"></span><br><span class="line"><span class="comment">## [1] 3 2 5 4 5</span></span><br><span class="line"></span><br><span class="line">runValue(chr.rle)</span><br><span class="line"></span><br><span class="line"><span class="comment">## [1] "Chr1" "Chr2" "Chr3" "Chr1" "Chr3"</span></span><br><span class="line"></span><br><span class="line">nrun(chr.rle)</span><br><span class="line"></span><br><span class="line"><span class="comment">## [1] 5</span></span><br><span class="line"></span><br><span class="line">start(chr.rle)</span><br><span class="line"></span><br><span class="line"><span class="comment">## [1]  1  4  6 11 15</span></span><br><span class="line"></span><br><span class="line">end(chr.rle)</span><br><span class="line"></span><br><span class="line"><span class="comment">## [1]  3  5 10 14 19</span></span><br><span class="line"></span><br><span class="line">width(chr.rle)</span><br><span class="line"></span><br><span class="line"><span class="comment">## [1] 3 2 5 4 5</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-3-属性替换"><a href="#1-2-3-属性替换" class="headerlink" title="1.2.3 属性替换:"></a>1.2.3 属性替换:</h3><p>Rle对象的长度和值还可以使用属性替换函数进行修改:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">runLength(chr.rle) &lt;- rep(<span class="number">3</span>, nrun(chr.rle))</span><br><span class="line">chr.rle</span><br><span class="line"></span><br><span class="line"><span class="comment">## character-Rle of length 15 with 5 runs</span></span><br><span class="line"><span class="comment">##   Lengths:      3      3      3      3      3</span></span><br><span class="line"><span class="comment">##   Values : "Chr1" "Chr2" "Chr3" "Chr1" "Chr3"</span></span><br><span class="line"></span><br><span class="line">runValue(chr.rle)[<span class="number">3</span>:<span class="number">4</span>] &lt;- c(<span class="string">"III"</span>, <span class="string">"IV"</span>)</span><br><span class="line">chr.rle</span><br><span class="line"></span><br><span class="line"><span class="comment">## character-Rle of length 15 with 5 runs</span></span><br><span class="line"><span class="comment">##   Lengths:      3      3      3      3      3</span></span><br><span class="line"><span class="comment">##   Values : "Chr1" "Chr2"  "III"   "IV" "Chr3"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 替换向量和被替换向量的长度必需相同,否则出错。下面两个语句都不正确:</span></span><br><span class="line">runValue(chr.rle) &lt;- c(<span class="string">"ChrI"</span>, <span class="string">"ChrV"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Error in .Call2("Rle_constructor", values, lengths, check, 0L, PACKAGE = "S4Vectors"): 'length(lengths)' != 'length(values)'</span></span><br><span class="line"></span><br><span class="line">runLength(chr.rle) &lt;- <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Error in .Call2("Rle_constructor", values, lengths, check, 0L, PACKAGE = "S4Vectors"): 'length(lengths)' != 'length(values)'</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-4-类型转换"><a href="#1-2-4-类型转换" class="headerlink" title="1.2.4 类型转换:"></a>1.2.4 类型转换:</h3><p>除使用as.vector函数外,Rle对象还可以使用很多函数进行类型转换,如:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">as.factor(chr.rle)</span><br><span class="line"></span><br><span class="line"><span class="comment">##  [1] Chr1 Chr1 Chr1 Chr2 Chr2 Chr2 III  III  III  IV   IV   IV   Chr3 Chr3</span></span><br><span class="line"><span class="comment">## [15] Chr3</span></span><br><span class="line"><span class="comment">## Levels: Chr1 Chr2 Chr3 III IV</span></span><br><span class="line"></span><br><span class="line">as.character(chr.rle)</span><br><span class="line"></span><br><span class="line"><span class="comment">##  [1] "Chr1" "Chr1" "Chr1" "Chr2" "Chr2" "Chr2" "III"  "III"  "III"  "IV"  </span></span><br><span class="line"><span class="comment">## [11] "IV"   "IV"   "Chr3" "Chr3" "Chr3"</span></span><br></pre></td></tr></table></figure>

<h3 id="1-2-5-Rle的S4类集团泛函数运算"><a href="#1-2-5-Rle的S4类集团泛函数运算" class="headerlink" title="1.2.5 Rle的S4类集团泛函数运算"></a>1.2.5 Rle的S4类集团泛函数运算</h3><p>Rle是BioC定义的基础数据类型。既然“基础”,那么它应当能进行R语言中数据的一般性运算,比如加减乘除、求模、求余等数学运算。事实也是如此,Rle支持R语言S4类集团泛函数(group generic functions,“集团通用函数”?)运算,包括算术、复数、比较、逻辑、数学函数和R语言的汇总(“max”, “min”, “range”, “prod”, “sum”, “any”, “all”等)运算(没有去验证是否所有运算都已实现)。下面仅简单具几个例子,具体情况请参考Rle-class的相关说明:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">set.seed(<span class="number">0</span>)</span><br><span class="line">rle1 &lt;- Rle(sample(<span class="number">4</span>, <span class="number">6</span>, replace = <span class="literal">TRUE</span>))</span><br><span class="line">rle2 &lt;- Rle(sample(<span class="number">5</span>, <span class="number">12</span>, replace = <span class="literal">TRUE</span>))</span><br><span class="line">rle3 &lt;- Rle(sample(<span class="number">4</span>, <span class="number">8</span>, replace = <span class="literal">TRUE</span>))</span><br><span class="line">rle1 + rle2</span><br><span class="line"></span><br><span class="line"><span class="comment">## integer-Rle of length 12 with 11 runs</span></span><br><span class="line"><span class="comment">##   Lengths: 1 1 1 1 1 1 1 1 1 2 1</span></span><br><span class="line"><span class="comment">##   Values : 9 7 6 7 5 3 5 6 4 7 5</span></span><br><span class="line"></span><br><span class="line">rle1 + rle3</span><br><span class="line"></span><br><span class="line"><span class="comment">## integer-Rle of length 8 with 8 runs</span></span><br><span class="line"><span class="comment">##   Lengths: 1 1 1 1 1 1 1 1</span></span><br><span class="line"><span class="comment">##   Values : 8 4 6 7 5 4 5 4</span></span><br><span class="line"></span><br><span class="line">rle1 * rle2</span><br><span class="line"></span><br><span class="line"><span class="comment">## integer-Rle of length 12 with 11 runs</span></span><br><span class="line"><span class="comment">##   Lengths:  1  1  1  1  1  1  1  1  1  2  1</span></span><br><span class="line"><span class="comment">##   Values : 20 10  8 12  4  2  4  8  4 12  4</span></span><br><span class="line"></span><br><span class="line">sqrt(rle1)</span><br><span class="line"></span><br><span class="line"><span class="comment">## numeric-Rle of length 6 with 5 runs</span></span><br><span class="line"><span class="comment">##   Lengths:                1                2 ...                1</span></span><br><span class="line"><span class="comment">##   Values :                2  1.4142135623731 ...                1</span></span><br><span class="line"></span><br><span class="line">range(rle1)</span><br><span class="line"></span><br><span class="line"><span class="comment">## [1] 1 4</span></span><br><span class="line"></span><br><span class="line">cumsum(rle1)</span><br><span class="line"></span><br><span class="line"><span class="comment">## integer-Rle of length 6 with 6 runs</span></span><br><span class="line"><span class="comment">##   Lengths:  1  1  1  1  1  1</span></span><br><span class="line"><span class="comment">##   Values :  4  6  8 11 15 16</span></span><br><span class="line"></span><br><span class="line">(rle1 &lt;- Rle(sample(DNA_BASES, <span class="number">10</span>, replace = <span class="literal">TRUE</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">## character-Rle of length 10 with 9 runs</span></span><br><span class="line"><span class="comment">##   Lengths:   1   1   1   1   2   1   1   1   1</span></span><br><span class="line"><span class="comment">##   Values : "C" "A" "C" "T" "C" "G" "C" "A" "T"</span></span><br><span class="line"></span><br><span class="line">(rle2 &lt;- Rle(sample(DNA_BASES, <span class="number">8</span>, replace = <span class="literal">TRUE</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment">## character-Rle of length 8 with 8 runs</span></span><br><span class="line"><span class="comment">##   Lengths:   1   1   1   1   1   1   1   1</span></span><br><span class="line"><span class="comment">##   Values : "G" "T" "A" "G" "C" "T" "G" "T"</span></span><br><span class="line"></span><br><span class="line">paste(rle1, rle2, sep = <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## character-Rle of length 10 with 10 runs</span></span><br><span class="line"><span class="comment">##   Lengths:    1    1    1    1    1    1    1    1    1    1</span></span><br><span class="line"><span class="comment">##   Values : "CG" "AT" "CA" "TG" "CC" "CT" "GG" "CT" "AG" "TT"</span></span><br></pre></td></tr></table></figure>

<h2 id="2-Ranges（序列区间-范围）"><a href="#2-Ranges（序列区间-范围）" class="headerlink" title="2 Ranges（序列区间/范围）"></a>2 Ranges（序列区间/范围）</h2><h3 id="2-1-BioC中的Ranges"><a href="#2-1-BioC中的Ranges" class="headerlink" title="2.1 BioC中的Ranges"></a>2.1 BioC中的Ranges</h3><p>Ranges是一类特殊但又常用的数据类型，它们可以表示小段序列在大段序列中的位置、名称和组织结构等信息。BioC中与Ranges定义有关的软件包主要有IRanges, GenomicRanges和GenomicFeatures。</p>
<p>IRanges包定义了Ranges的一般数据结构和处理方法，但不直接面向序列处理；GenomicRanges包定义的GRanges和GRangesList类除了储存Ranges信息外还包含了序列的名称和DNA链等信息；而GenomicFeatures（包）则处理以数据库形式提供的GRanges信息，如基因、外显子、内含子、启动子、UTR等。</p>
<p>先看看BioC中Ranges最基本的类定义：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">getClass(<span class="string">"Ranges"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Virtual Class "Ranges" [package "IRanges"]</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Slots:</span></span><br><span class="line"><span class="comment">##                                                       </span></span><br><span class="line"><span class="comment">## Name:      elementType elementMetadata        metadata</span></span><br><span class="line"><span class="comment">## Class:       character DataTableORNULL            list</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Extends: </span></span><br><span class="line"><span class="comment">## Class "IntegerList", directly</span></span><br><span class="line"><span class="comment">## Class "RangesORmissing", directly</span></span><br><span class="line"><span class="comment">## Class "AtomicList", by class "IntegerList", distance 2</span></span><br><span class="line"><span class="comment">## Class "List", by class "IntegerList", distance 3</span></span><br><span class="line"><span class="comment">## Class "Vector", by class "IntegerList", distance 4</span></span><br><span class="line"><span class="comment">## Class "Annotated", by class "IntegerList", distance 5</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## Known Subclasses: </span></span><br><span class="line"><span class="comment">## Class "IRanges", directly</span></span><br><span class="line"><span class="comment">## Class "Partitioning", directly</span></span><br><span class="line"><span class="comment">## Class "GappedRanges", directly</span></span><br><span class="line"><span class="comment">## Class "NCList", directly</span></span><br><span class="line"><span class="comment">## Class "IntervalTree", directly</span></span><br><span class="line"><span class="comment">## Class "NormalIRanges", by class "IRanges", distance 2</span></span><br><span class="line"><span class="comment">## Class "PartitioningByEnd", by class "Partitioning", distance 2</span></span><br><span class="line"><span class="comment">## Class "PartitioningByWidth", by class "Partitioning", distance 2</span></span><br><span class="line"><span class="comment">## Class "PartitioningMap", by class "Partitioning", distance 3</span></span><br></pre></td></tr></table></figure>

<p>Ranges是虚拟类，实际应用中最常用的IRanges子类，它继承了Ranges的数据结构，另外多设置了3个slots（存储槽），分别用于存贮Ranges的起点、宽度和名称信息。由于Ranges由整数确定，所以称为IRanges（Integer Ranges，整数区间），但也有人理解成间隔区间（Interval Ranges）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">getSlots(<span class="string">"Ranges"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">##       elementType   elementMetadata          metadata </span></span><br><span class="line"><span class="comment">##       "character" "DataTableORNULL"            "list"</span></span><br><span class="line"></span><br><span class="line">getSlots(<span class="string">"IRanges"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">##             start             width             NAMES       elementType </span></span><br><span class="line"><span class="comment">##         "integer"         "integer" "characterORNULL"       "character" </span></span><br><span class="line"><span class="comment">##   elementMetadata          metadata </span></span><br><span class="line"><span class="comment">## "DataTableORNULL"            "list"</span></span><br></pre></td></tr></table></figure>

<p>GRanges是Ranges概念在序列处理上的具体应用，但它和IRanges没有继承关系：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(GenomicRanges)</span><br><span class="line">getSlots(<span class="string">"GRanges"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">##        seqnames          ranges          strand elementMetadata </span></span><br><span class="line"><span class="comment">##           "Rle"       "IRanges"           "Rle"     "DataFrame" </span></span><br><span class="line"><span class="comment">##         seqinfo        metadata </span></span><br><span class="line"><span class="comment">##       "Seqinfo"          "list"</span></span><br></pre></td></tr></table></figure>

<p>Ranges对于序列处理非常重要，除GenomicRanges外，Biostrings一些类的定义也应用了Ranges：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">getSlots(<span class="string">"XStringViews"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">##           subject            ranges       elementType   elementMetadata </span></span><br><span class="line"><span class="comment">##         "XString"         "IRanges"       "character" "DataTableORNULL" </span></span><br><span class="line"><span class="comment">##          metadata </span></span><br><span class="line"><span class="comment">##            "list"</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-对象构建和属性获取"><a href="#2-2-对象构建和属性获取" class="headerlink" title="2.2 对象构建和属性获取"></a>2.2 对象构建和属性获取</h4><p>IRanges对象可以使用对象构造函数IRanges产生，需提供起点（start）、终点（end）和宽度（width）三个参数中的任意两个：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ir1 &lt;- IRanges(start = <span class="number">1</span>:<span class="number">10</span>, width = <span class="number">10</span>:<span class="number">1</span>)</span><br><span class="line">ir2 &lt;- IRanges(start = <span class="number">1</span>:<span class="number">10</span>, end = <span class="number">11</span>)</span><br><span class="line">ir3 &lt;- IRanges(end = <span class="number">11</span>, width = <span class="number">10</span>:<span class="number">1</span>)</span><br><span class="line">ir1</span><br><span class="line"></span><br><span class="line"><span class="comment">## IRanges of length 10</span></span><br><span class="line"><span class="comment">##      start end width</span></span><br><span class="line"><span class="comment">## [1]      1  10    10</span></span><br><span class="line"><span class="comment">## [2]      2  10     9</span></span><br><span class="line"><span class="comment">## [3]      3  10     8</span></span><br><span class="line"><span class="comment">## [4]      4  10     7</span></span><br><span class="line"><span class="comment">## [5]      5  10     6</span></span><br><span class="line"><span class="comment">## [6]      6  10     5</span></span><br><span class="line"><span class="comment">## [7]      7  10     4</span></span><br><span class="line"><span class="comment">## [8]      8  10     3</span></span><br><span class="line"><span class="comment">## [9]      9  10     2</span></span><br><span class="line"><span class="comment">## [10]    10  10     1</span></span><br></pre></td></tr></table></figure>

<p>GRanges对象也可以使用构造函数生成，其方式与数据框对象生成有些类似：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">genes &lt;- GRanges(seqnames = c(<span class="string">"Chr1"</span>, <span class="string">"Chr3"</span>, <span class="string">"Chr3"</span>), ranges = IRanges(start = c(<span class="number">1300</span>,</span><br><span class="line">    <span class="number">1050</span>, <span class="number">2000</span>), end = c(<span class="number">2500</span>, <span class="number">1870</span>, <span class="number">3200</span>)), strand = c(<span class="string">"+"</span>, <span class="string">"+"</span>, <span class="string">"-"</span>), seqlengths = c(Chr1 = <span class="number">1e+05</span>,</span><br><span class="line">    Chr3 = <span class="number">2e+05</span>))</span><br><span class="line">genes</span><br><span class="line"></span><br><span class="line"><span class="comment">## GRanges object with 3 ranges and 0 metadata columns:</span></span><br><span class="line"><span class="comment">##       seqnames       ranges strand</span></span><br><span class="line"><span class="comment">##          &lt;Rle&gt;    &lt;IRanges&gt;  &lt;Rle&gt;</span></span><br><span class="line"><span class="comment">##   [1]     Chr1 [1300, 2500]      +</span></span><br><span class="line"><span class="comment">##   [2]     Chr3 [1050, 1870]      +</span></span><br><span class="line"><span class="comment">##   [3]     Chr3 [2000, 3200]      -</span></span><br><span class="line"><span class="comment">##   -------</span></span><br><span class="line"><span class="comment">##   seqinfo: 2 sequences from an unspecified genome</span></span><br></pre></td></tr></table></figure>

<p>IRanges和GRanges都是S4类，其属性获取有相应的函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">start(ir1)</span><br><span class="line"></span><br><span class="line"><span class="comment">##  [1]  1  2  3  4  5  6  7  8  9 10</span></span><br><span class="line"></span><br><span class="line">end(ir1)</span><br><span class="line"></span><br><span class="line"><span class="comment">##  [1] 10 10 10 10 10 10 10 10 10 10</span></span><br><span class="line"></span><br><span class="line">width(ir1)</span><br><span class="line"></span><br><span class="line"><span class="comment">##  [1] 10  9  8  7  6  5  4  3  2  1</span></span><br><span class="line"></span><br><span class="line">ranges(genes)</span><br><span class="line"></span><br><span class="line"><span class="comment">## IRanges of length 3</span></span><br><span class="line"><span class="comment">##     start  end width</span></span><br><span class="line"><span class="comment">## [1]  1300 2500  1201</span></span><br><span class="line"><span class="comment">## [2]  1050 1870   821</span></span><br><span class="line"><span class="comment">## [3]  2000 3200  1201</span></span><br><span class="line"></span><br><span class="line">start(ranges(genes))</span><br><span class="line"></span><br><span class="line"><span class="comment">## [1] 1300 1050 2000</span></span><br></pre></td></tr></table></figure>

<p>Views对象也包含有IRanges属性：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 按长度设置产生随机序列的函数</span></span><br><span class="line">rndSeq &lt;- <span class="keyword">function</span>(dict, n) &#123;</span><br><span class="line">    paste(sample(dict, n, replace = <span class="literal">T</span>), collapse = <span class="string">""</span>)</span><br><span class="line">&#125;</span><br><span class="line">set.seed(<span class="number">0</span>)</span><br><span class="line">dna &lt;- DNAString(rndSeq(DNA_BASES, <span class="number">1000</span>))</span><br><span class="line">vws &lt;- as(maskMotif(dna, <span class="string">"TGA"</span>), <span class="string">"Views"</span>)</span><br><span class="line">(ir &lt;- ranges(vws))</span><br><span class="line"></span><br><span class="line"><span class="comment">## IRanges of length 18</span></span><br><span class="line"><span class="comment">##      start  end width</span></span><br><span class="line"><span class="comment">## [1]      1  104   104</span></span><br><span class="line"><span class="comment">## [2]    108  264   157</span></span><br><span class="line"><span class="comment">## [3]    268  268     1</span></span><br><span class="line"><span class="comment">## [4]    272  300    29</span></span><br><span class="line"><span class="comment">## [5]    304  393    90</span></span><br><span class="line"><span class="comment">## ...    ...  ...   ...</span></span><br><span class="line"><span class="comment">## [14]   586  752   167</span></span><br><span class="line"><span class="comment">## [15]   756  851    96</span></span><br><span class="line"><span class="comment">## [16]   855  912    58</span></span><br><span class="line"><span class="comment">## [17]   916  989    74</span></span><br><span class="line"><span class="comment">## [18]   993 1000     8</span></span><br></pre></td></tr></table></figure>

<p>模式匹配的match类函数返回IRanges对象，而vmatch类函数返回GRanges类对象：</p>
<h4 id="2-3-IRanges对象的运算和处理方法"><a href="#2-3-IRanges对象的运算和处理方法" class="headerlink" title="2.3 IRanges对象的运算和处理方法"></a>2.3 IRanges对象的运算和处理方法</h4><h5 id="2-3-1-Ranges内变换（Intra-range-transformations）"><a href="#2-3-1-Ranges内变换（Intra-range-transformations）" class="headerlink" title="2.3.1 Ranges内变换（Intra-range transformations）"></a>2.3.1 Ranges内变换（Intra-range transformations）</h5><p>这种类型的处理函数包括shift，flank，narrow，reflect，resize，restrict和promoters等，它们对每个Ranges进行独立处理。为了方便理解，我们使用IRanges包的Vignette提供的一个很有用的IRanges作图函数（稍做修改）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">plotRanges &lt;- <span class="keyword">function</span>(x, xlim = x, main = deparse(substitute(x)), col = <span class="string">"black"</span>,</span><br><span class="line">    add = <span class="literal">FALSE</span>, ybottom = <span class="literal">NULL</span>, <span class="keyword">...</span>) &#123;</span><br><span class="line">    <span class="keyword">require</span>(scales)</span><br><span class="line">    col &lt;- alpha(col, <span class="number">0.5</span>)</span><br><span class="line">    height &lt;- <span class="number">1</span></span><br><span class="line">    sep &lt;- <span class="number">0.5</span></span><br><span class="line">    <span class="keyword">if</span> (is(xlim, <span class="string">"Ranges"</span>)) &#123;</span><br><span class="line">        xlim &lt;- c(min(start(xlim)), max(end(xlim)) * <span class="number">1.2</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!add) &#123;</span><br><span class="line">        bins &lt;- disjointBins(IRanges(start(x), end(x) + <span class="number">1</span>))</span><br><span class="line">        ybottom &lt;- bins * (sep + height) - height</span><br><span class="line">        par(mar = c(<span class="number">3</span>, <span class="number">0.5</span>, <span class="number">2.5</span>, <span class="number">0.5</span>), mgp = c(<span class="number">1.5</span>, <span class="number">0.5</span>, <span class="number">0</span>))</span><br><span class="line">        plot.new()</span><br><span class="line">        plot.window(xlim, c(<span class="number">0</span>, max(bins) * (height + sep)))</span><br><span class="line">    &#125;</span><br><span class="line">    rect(start(x) - <span class="number">0.5</span>, ybottom, end(x) + <span class="number">0.5</span>, ybottom + height, col = col,</span><br><span class="line">        <span class="keyword">...</span>)</span><br><span class="line">    text((start(x) + end(x))/<span class="number">2</span>, ybottom + height/<span class="number">2</span>, <span class="number">1</span>:length(x), col = <span class="string">"white"</span>,</span><br><span class="line">        xpd = <span class="literal">TRUE</span>)</span><br><span class="line">    title(main)</span><br><span class="line">    axis(<span class="number">1</span>)</span><br><span class="line">    invisible(ybottom)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>shift函数对Ranges进行平移（下面图形中蓝色为原始Ranges，红色为变换后的Ranges，黑色/灰色则为参考Ranges，其他颜色为重叠区域）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ir &lt;- IRanges(c(<span class="number">3000</span>, <span class="number">2500</span>), width = c(<span class="number">300</span>, <span class="number">850</span>))</span><br><span class="line">ir.trans &lt;- shift(ir, <span class="number">500</span>)</span><br><span class="line">xlim &lt;- c(<span class="number">0</span>, max(end(ir, ir.trans)) * <span class="number">1.3</span>)</span><br><span class="line">ybottom &lt;- plotRanges(ir, xlim = xlim, main = <span class="string">"shift"</span>, col = <span class="string">"blue"</span>)</span><br><span class="line">plotRanges(ir.trans, add = <span class="literal">TRUE</span>, ybottom = ybottom, main = <span class="string">""</span>, col = <span class="string">"red"</span>)</span><br></pre></td></tr></table></figure>

<p>flank函数获取Ranges的相邻区域，width参数为整数表示左侧，负数表示右侧：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ir.trans &lt;- flank(ir, width = <span class="number">200</span>)</span><br><span class="line">xlim &lt;- c(<span class="number">0</span>, max(end(ir, ir.trans)) * <span class="number">1.3</span>)</span><br><span class="line">ybottom &lt;- plotRanges(ir, xlim = xlim, main = <span class="string">"flank"</span>, col = <span class="string">"blue"</span>)</span><br><span class="line">plotRanges(ir.trans, add = <span class="literal">TRUE</span>, ybottom = ybottom, main = <span class="string">""</span>, col = <span class="string">"red"</span>)</span><br></pre></td></tr></table></figure>

<p>reflect函数获取Ranges的镜面对称区域，bounds为用于设置镜面位置的Ranges对象：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bounds &lt;- IRanges(c(<span class="number">2000</span>, <span class="number">3000</span>), width = <span class="number">500</span>)</span><br><span class="line">ir.trans &lt;- reflect(ir, bounds = bounds)</span><br><span class="line">xlim &lt;- c(<span class="number">0</span>, max(end(ir, ir.trans, bounds)) * <span class="number">1.3</span>)</span><br><span class="line">ybottom &lt;- plotRanges(ir, xlim = xlim, main = <span class="string">"reflect"</span>, col = <span class="string">"blue"</span>)</span><br><span class="line">plotRanges(bounds, add = <span class="literal">TRUE</span>, ybottom = ybottom, main = <span class="string">""</span>)</span><br><span class="line">plotRanges(ir.trans, add = <span class="literal">TRUE</span>, ybottom = ybottom, main = <span class="string">""</span>, col = <span class="string">"red"</span>)</span><br></pre></td></tr></table></figure>

<p>promoters函数获取promoter区域，upstream和downstream分别设置上游和下游截取的序列长度：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ir.trans &lt;- promoters(ir, upstream = <span class="number">1000</span>, downstream = <span class="number">100</span>)</span><br><span class="line">xlim &lt;- c(<span class="number">0</span>, max(end(ir, ir.trans)) * <span class="number">1.3</span>)</span><br><span class="line">ybottom &lt;- plotRanges(ir, xlim = xlim, main = <span class="string">"promoters"</span>, col = <span class="string">"blue"</span>)</span><br><span class="line">plotRanges(ir.trans, add = <span class="literal">TRUE</span>, ybottom = ybottom, main = <span class="string">""</span>, col = <span class="string">"red"</span>)</span><br></pre></td></tr></table></figure>

<p>resize函数改变Ranges的大小，width设置宽度，fix设置固定位置（start/end/center）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ir.trans &lt;- resize(ir, width = c(<span class="number">100</span>, <span class="number">1300</span>), fix = <span class="string">"start"</span>)</span><br><span class="line">xlim &lt;- c(<span class="number">0</span>, max(end(ir, ir.trans)) * <span class="number">1.3</span>)</span><br><span class="line">ybottom &lt;- plotRanges(ir, xlim = xlim, main = <span class="string">"resize, fix=\"start\""</span>, col = <span class="string">"blue"</span>)</span><br><span class="line">plotRanges(ir.trans, add = <span class="literal">TRUE</span>, ybottom = ybottom, main = <span class="string">""</span>, col = <span class="string">"red"</span>)</span><br><span class="line">ir.trans &lt;- resize(ir, width = c(<span class="number">100</span>, <span class="number">1300</span>), fix = <span class="string">"center"</span>)</span><br><span class="line">xlim &lt;- c(<span class="number">0</span>, max(end(ir, ir.trans)) * <span class="number">1.3</span>)</span><br><span class="line">ybottom &lt;- plotRanges(ir, xlim = xlim, main = <span class="string">"resize, fix=\"center\""</span>, col = <span class="string">"blue"</span>)</span><br><span class="line">plotRanges(ir.trans, add = <span class="literal">TRUE</span>, ybottom = ybottom, main = <span class="string">""</span>, col = <span class="string">"red"</span>)</span><br></pre></td></tr></table></figure>

<p>其他函数的使用请自行尝试使用。</p>
<h4 id="2-3-2-Ranges间转换（Inter-range-transformations）"><a href="#2-3-2-Ranges间转换（Inter-range-transformations）" class="headerlink" title="2.3.2 Ranges间转换（Inter-range transformations）"></a>2.3.2 Ranges间转换（Inter-range transformations）</h4><p>range函数用于获取Ranges所包括的整个区域（包括间隔区）；reduce将重叠区域合并；gaps用于获取间隔区域：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ir &lt;- IRanges(c(<span class="number">200</span>, <span class="number">1000</span>, <span class="number">3000</span>, <span class="number">2500</span>), width = c(<span class="number">600</span>, <span class="number">1000</span>, <span class="number">300</span>, <span class="number">850</span>))</span><br><span class="line">ir.trans &lt;- range(ir)</span><br><span class="line">xlim &lt;- c(<span class="number">0</span>, max(end(ir, ir.trans)) * <span class="number">1.3</span>)</span><br><span class="line">ybottom &lt;- plotRanges(ir, xlim = xlim, col = <span class="string">"blue"</span>)</span><br><span class="line">plotRanges(ir.trans, xlim = xlim, col = <span class="string">"red"</span>, main = <span class="string">"range"</span>)</span><br><span class="line">ir.trans &lt;- reduce(ir)</span><br><span class="line">plotRanges(ir.trans, xlim = xlim, col = <span class="string">"red"</span>, main = <span class="string">"reduce"</span>)</span><br><span class="line">ir.trans &lt;- gaps(ir)</span><br><span class="line">plotRanges(ir.trans, xlim = xlim, col = <span class="string">"red"</span>, main = <span class="string">"gaps"</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-3-3-Ranges对象间的集合运算"><a href="#2-3-3-Ranges对象间的集合运算" class="headerlink" title="2.3.3 Ranges对象间的集合运算"></a>2.3.3 Ranges对象间的集合运算</h4><p>intersect求交集区域；setdiff求差异区域；union求并集：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ir1 &lt;- IRanges(c(<span class="number">200</span>, <span class="number">1000</span>, <span class="number">3000</span>, <span class="number">2500</span>), width = c(<span class="number">600</span>, <span class="number">1000</span>, <span class="number">300</span>, <span class="number">850</span>))</span><br><span class="line">ir2 &lt;- IRanges(c(<span class="number">100</span>, <span class="number">1500</span>, <span class="number">2000</span>, <span class="number">3500</span>), width = c(<span class="number">600</span>, <span class="number">800</span>, <span class="number">1000</span>, <span class="number">550</span>))</span><br><span class="line">xlim &lt;- c(<span class="number">0</span>, max(end(ir1, ir2)) * <span class="number">1.3</span>)</span><br><span class="line">ybottom &lt;- plotRanges(reduce(ir1), xlim = xlim, col = <span class="string">"blue"</span>, main = <span class="string">"original"</span>)</span><br><span class="line">plotRanges(reduce(ir2), xlim = xlim, col = <span class="string">"blue"</span>, main = <span class="string">""</span>, add = <span class="literal">TRUE</span>, ybottom = ybottom)</span><br><span class="line">plotRanges(intersect(ir1, ir2), xlim = xlim, col = <span class="string">"red"</span>)</span><br><span class="line">plotRanges(setdiff(ir1, ir2), xlim = xlim, col = <span class="string">"red"</span>)</span><br><span class="line">plotRanges(union(ir1, ir2), xlim = xlim, col = <span class="string">"red"</span>)</span><br></pre></td></tr></table></figure>

<p>此外还有punion，pintersect，psetdiff和pgap函数，进行element-wise的运算。</p>
<h2 id="3-SessionInfo"><a href="#3-SessionInfo" class="headerlink" title="3 SessionInfo()"></a>3 SessionInfo()</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">sessionInfo()</span><br><span class="line"></span><br><span class="line"><span class="comment">## R version 3.2.2 (2015-08-14)</span></span><br><span class="line"><span class="comment">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span><br><span class="line"><span class="comment">## Running under: Debian GNU/Linux 8 (jessie)</span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## locale:</span></span><br><span class="line"><span class="comment">##  [1] LC_CTYPE=zh_CN.utf8       LC_NUMERIC=C             </span></span><br><span class="line"><span class="comment">##  [3] LC_TIME=zh_CN.utf8        LC_COLLATE=zh_CN.utf8    </span></span><br><span class="line"><span class="comment">##  [5] LC_MONETARY=zh_CN.utf8    LC_MESSAGES=zh_CN.utf8   </span></span><br><span class="line"><span class="comment">##  [7] LC_PAPER=zh_CN.utf8       LC_NAME=C                </span></span><br><span class="line"><span class="comment">##  [9] LC_ADDRESS=C              LC_TELEPHONE=C           </span></span><br><span class="line"><span class="comment">## [11] LC_MEASUREMENT=zh_CN.utf8 LC_IDENTIFICATION=C      </span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## attached base packages:</span></span><br><span class="line"><span class="comment">## [1] stats4    parallel  stats     graphics  grDevices utils     datasets </span></span><br><span class="line"><span class="comment">## [8] methods   base     </span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## other attached packages:</span></span><br><span class="line"><span class="comment">##  [1] scales_0.3.0         GenomicRanges_1.18.4 GenomeInfoDb_1.2.5  </span></span><br><span class="line"><span class="comment">##  [4] Biostrings_2.34.1    XVector_0.6.0        IRanges_2.0.1       </span></span><br><span class="line"><span class="comment">##  [7] S4Vectors_0.4.0      BiocGenerics_0.12.1  zblog_0.1.0         </span></span><br><span class="line"><span class="comment">## [10] knitr_1.11          </span></span><br><span class="line"><span class="comment">## </span></span><br><span class="line"><span class="comment">## loaded via a namespace (and not attached):</span></span><br><span class="line"><span class="comment">##  [1] Rcpp_0.12.0      plyr_1.8.3       formatR_1.2      magrittr_1.5    </span></span><br><span class="line"><span class="comment">##  [5] evaluate_0.7.2   highr_0.5        stringi_0.5-5    zlibbioc_1.12.0 </span></span><br><span class="line"><span class="comment">##  [9] tools_3.2.2      stringr_1.0.0    munsell_0.4.2    colorspace_1.2-6</span></span><br></pre></td></tr></table></figure>

<h3 id="本文转载至原文链接"><a href="#本文转载至原文链接" class="headerlink" title="本文转载至原文链接"></a>本文转载至<a href="https://blog.csdn.net/u014801157/article/details/24372479" target="_blank" rel="noopener">原文链接</a></h3></div><div class="post-copyright"><blockquote><p>原文作者: Billy &amp; Barney</p><p>原文链接: <a href="https://liangbilin.github.io/2020/06/10/Billy--Rle和Ranges（转载）/">https://liangbilin.github.io/2020/06/10/Billy--Rle和Ranges（转载）/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2020/05/07/Barnery--%E6%97%A0%E9%99%90%E5%88%97%E8%A1%A8%E7%9A%84%E5%AE%9E%E7%8E%B0IntersectionObserver/" class="next">Barnery--无限列表的实现IntersectionObserver</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Rle-Run-Length-Encoding-行程编码"><span class="toc-text">1. Rle(Run Length Encoding,行程编码)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Rle类和Rle对象"><span class="toc-text">1.1 Rle类和Rle对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Rle对象的处理方法"><span class="toc-text">1.2 Rle对象的处理方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-Rle对象构建-获取"><span class="toc-text">1.2.1 Rle对象构建&#x2F;获取:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-获取属性"><span class="toc-text">1.2.2 获取属性:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-属性替换"><span class="toc-text">1.2.3 属性替换:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-类型转换"><span class="toc-text">1.2.4 类型转换:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-Rle的S4类集团泛函数运算"><span class="toc-text">1.2.5 Rle的S4类集团泛函数运算</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Ranges（序列区间-范围）"><span class="toc-text">2 Ranges（序列区间&#x2F;范围）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-BioC中的Ranges"><span class="toc-text">2.1 BioC中的Ranges</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-对象构建和属性获取"><span class="toc-text">2.2 对象构建和属性获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-IRanges对象的运算和处理方法"><span class="toc-text">2.3 IRanges对象的运算和处理方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-Ranges内变换（Intra-range-transformations）"><span class="toc-text">2.3.1 Ranges内变换（Intra-range transformations）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-Ranges间转换（Inter-range-transformations）"><span class="toc-text">2.3.2 Ranges间转换（Inter-range transformations）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-Ranges对象间的集合运算"><span class="toc-text">2.3.3 Ranges对象间的集合运算</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-SessionInfo"><span class="toc-text">3 SessionInfo()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#本文转载至原文链接"><span class="toc-text">本文转载至原文链接</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/06/10/Billy--Rle%E5%92%8CRanges%EF%BC%88%E8%BD%AC%E8%BD%BD%EF%BC%89/">Rle和Ranges(转载)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/07/Barnery--%E6%97%A0%E9%99%90%E5%88%97%E8%A1%A8%E7%9A%84%E5%AE%9E%E7%8E%B0IntersectionObserver/">Barnery--无限列表的实现IntersectionObserver</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/07/Barnery--%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82%E5%8A%A0%E9%94%81/">Barnery--数据请求加锁</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/25/Billy--%20BWT%E6%AF%94%E5%AF%B9%E7%AE%97%E6%B3%95/">BWT比对算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/20/Barnery--%E7%BC%96%E7%A0%81%E7%BA%A2%E7%BA%BF/">编码红线</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/20/Billy--%E5%88%A9%E7%94%A8CIPRES%E4%BA%91%E8%AE%A1%E7%AE%97%E6%9E%84%E5%BB%BA%E6%9C%80%E5%A4%A7%E4%BC%BC%E7%84%B6%E8%BF%9B%E5%8C%96%E6%A0%91/">利用CIPRES云计算构建最大似然进化树</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/06/Billy--Python%E5%A4%8D%E5%90%88%E8%AF%AD%E6%B3%95/">Python语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/27/Billy--%E5%88%A9%E7%94%A8NCBI%E7%9A%84Blast+%E8%BF%9B%E8%A1%8C%E6%9C%AC%E5%9C%B0%E5%8C%96%E5%BA%8F%E5%88%97%E7%9B%B8%E4%BC%BC%E6%80%A7%E6%A3%80%E7%B4%A2/">利用NCBI的Blast+进行本地化序列相似性检索</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/24/Barney--JS%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/">JS面向对象程序设计</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/23/Barnery--%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B/">JS的引用类型</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Barney/">Barney</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Billy/">Billy</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/R-Bioconductor/">R - Bioconductor</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/" style="font-size: 15px;">神经网络</a> <a href="/tags/%E4%BA%8C%E4%BB%A3%E6%B5%8B%E5%BA%8F/" style="font-size: 15px;">二代测序</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%BE%85%E5%8A%A9%E8%8D%AF%E7%89%A9%E8%AE%BE%E8%AE%A1/" style="font-size: 15px;">计算机辅助药物设计</a> <a href="/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E7%A8%8B/" style="font-size: 15px;">软件教程</a> <a href="/tags/%E7%BA%B3%E7%B1%B3%E5%AD%94%E6%B5%8B%E5%BA%8F/" style="font-size: 15px;">纳米孔测序</a> <a href="/tags/%E8%A1%A8%E8%A7%82%E7%BB%84/" style="font-size: 15px;">表观组</a> <a href="/tags/%E8%BD%AC%E5%BD%95%E7%BB%84/" style="font-size: 15px;">转录组</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/%E8%82%BF%E7%98%A4/" style="font-size: 15px;">肿瘤</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/" style="font-size: 15px;">软件工程</a> <a href="/tags/Database/" style="font-size: 15px;">Database</a> <a href="/tags/%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/" style="font-size: 15px;">标记语言</a> <a href="/tags/Demo/" style="font-size: 15px;">Demo</a> <a href="/tags/%E6%96%B0%E7%94%9F%E6%8A%97%E5%8E%9F/" style="font-size: 15px;">新生抗原</a> <a href="/tags/R/" style="font-size: 15px;">R</a> <a href="/tags/%E7%BB%84%E5%AD%A6%E5%88%86%E6%9E%90/" style="font-size: 15px;">组学分析</a> <a href="/tags/%E8%BF%9B%E5%8C%96%E6%A0%91/" style="font-size: 15px;">进化树</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 15px;">算法</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">20</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://asia.ensembl.org/index.html" title="ensembl" target="_blank">ensembl</a><ul></ul><a href="https://sci-hub.tw/" title="sci-hub" target="_blank">sci-hub</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Billy &amp; Barney.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/" target="_blank" rel="noopener"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>