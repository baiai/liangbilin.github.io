<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><title>samtools常用命令详解(转载) | Billy and Barney's Blog</title><meta name="generator" content="Hexo 4.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">samtools常用命令详解(转载)</h1><a id="logo" href="/.">Billy and Barney's Blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">samtools常用命令详解(转载)</h1><div class="post-meta"><a href="/2019/06/16/Billy--%E8%BD%AF%E4%BB%B6samtools%E6%95%99%E7%A8%8B%EF%BC%88%E8%BD%AC%E8%BD%BD%EF%BC%89/#comments" class="comment-count"></a><p><span class="date">Jun 16, 2019</span><span><a href="/categories/Billy/" class="category">Billy</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h3 id="1-View"><a href="#1-View" class="headerlink" title="1. View"></a>1. View</h3><p>view命令的主要功能是:将sam文件转换成bam文件;然后对bam文件进行各种操作,比如数据的排序(不属于本命令的功能)和提取(这些操作 是对bam文件进行的,因而当输入为sam文件的时候,不能进行该操作);最后将排序或提取得到的数据输出为bam或sam(默认的)格式。</p>
<p>bam文件优点:bam文件为二进制文件,占用的磁盘空间比sam文本文件小;利用bam二进制文件的运算速度快。</p>
<p>view命令中,对sam文件头部的输入(-t或-T)和输出(-h)是单独的一些参数来控制的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">Usage: samtools view [options] &lt;in.bam&gt;|&lt;in.sam&gt; [region1 [...]]</span><br><span class="line">默认情况下不加 region,则是输出所有的 region.</span><br><span class="line">Options: -b       output BAM</span><br><span class="line"></span><br><span class="line">默认下输出是 SAM 格式文件,该参数设置输出 BAM 格式</span><br><span class="line"></span><br><span class="line">-h       print header for the SAM output</span><br><span class="line"></span><br><span class="line">默认下输出的 sam 格式文件不带 header,该参数设定输出sam文件时带 header 信息</span><br><span class="line"></span><br><span class="line">-H       print header only (no alignments)</span><br><span class="line"></span><br><span class="line">-S       input is SAM</span><br><span class="line"></span><br><span class="line">默认下输入是 BAM 文件,若是输入是 SAM 文件,则最好加该参数,否则有时候会报错。</span><br><span class="line"></span><br><span class="line">-u       uncompressed BAM output (force -b)</span><br><span class="line"></span><br><span class="line">该参数的使用需要有-b参数,能节约时间,但是需要更多磁盘空间。</span><br><span class="line"></span><br><span class="line">-c       Instead of printing the alignments, only count them and print the</span><br><span class="line"></span><br><span class="line">total number. All filter options, such as ‘-f’, ‘-F’ and ‘-q’ ,</span><br><span class="line"></span><br><span class="line">are taken into account.</span><br><span class="line"></span><br><span class="line">-1       fast compression (force -b)</span><br><span class="line"></span><br><span class="line">-x       output FLAG in HEX (samtools-C specific)</span><br><span class="line"></span><br><span class="line">-X       output FLAG in string (samtools-C specific)</span><br><span class="line"></span><br><span class="line">-c       print only the count of matching records</span><br><span class="line"></span><br><span class="line">-L FILE  output alignments overlapping the input BED FILE [null]</span><br><span class="line"></span><br><span class="line">-t FILE  list of reference names and lengths (force -S) [null]</span><br><span class="line"></span><br><span class="line">使用一个list文件来作为header的输入</span><br><span class="line"></span><br><span class="line">-T FILE  reference sequence file (force -S) [null]</span><br><span class="line"></span><br><span class="line">使用序列fasta文件作为header的输入</span><br><span class="line"></span><br><span class="line">-o FILE  output file name [stdout]</span><br><span class="line"></span><br><span class="line">-R FILE  list of read groups to be outputted [null]</span><br><span class="line"></span><br><span class="line">-f INT   required flag, 0 for unset [0]</span><br><span class="line"></span><br><span class="line">-F INT   filtering flag, 0 for unset [0]</span><br><span class="line"></span><br><span class="line">Skip alignments with bits present in INT [0]</span><br><span class="line"></span><br><span class="line">数字4代表该序列没有比对到参考序列上</span><br><span class="line"></span><br><span class="line">数字8代表该序列的mate序列没有比对到参考序列上</span><br><span class="line"></span><br><span class="line">-q INT   minimum mapping quality [0]</span><br><span class="line"></span><br><span class="line">-l STR   only output reads in library STR [null]</span><br><span class="line"></span><br><span class="line">-r STR   only output reads in read group STR [null]</span><br><span class="line"></span><br><span class="line">-s FLOAT fraction of templates to subsample; integer part as seed [-1]</span><br><span class="line"></span><br><span class="line">-?       longer help</span><br></pre></td></tr></table></figure>

<p>例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">将sam文件转换成bam文件</span><br><span class="line">$ samtools view -bS abc.sam &gt; abc.bam</span><br><span class="line">$ samtools view -b -S abc.sam -o abc.bam</span><br><span class="line">提取比对到参考序列上的比对结果</span><br><span class="line"></span><br><span class="line">$ samtools view -bF 4 abc.bam &gt; abc.F.bam</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">提取paired reads中两条reads都比对到参考序列上的比对结果,只需要把两个4+8的值12作为过滤参数即可</span><br><span class="line"></span><br><span class="line">$ samtools view -bF 12 abc.bam &gt; abc.F12.bam</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">提取没有比对到参考序列上的比对结果</span><br><span class="line"></span><br><span class="line">$ samtools view -bf 4 abc.bam &gt; abc.f.bam</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">提取bam文件中比对到caffold1上的比对结果,并保存到sam文件格式</span><br><span class="line"></span><br><span class="line">$ samtools view abc.bam scaffold1 &gt; scaffold1.sam</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">提取scaffold1上能比对到30k到100k区域的比对结果</span><br><span class="line"></span><br><span class="line">$ samtools view abc.bam scaffold1:30000-100000 $gt; scaffold1_30k-100k.sam</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">根据fasta文件,将 header 加入到 sam 或 bam 文件中</span><br><span class="line"></span><br><span class="line">$ samtools view -T genome.fasta -h scaffold1.sam &gt; scaffold1.h.sam</span><br></pre></td></tr></table></figure>

<h3 id="2-Sort"><a href="#2-Sort" class="headerlink" title="2. Sort"></a>2. Sort</h3><p>sort对bam文件进行排序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Usage: samtools sort [-n] [-m &lt;maxMem&gt;] &lt;in.bam&gt; &lt;out.prefix&gt;  </span><br><span class="line">-m 参数默认下是 500,000,000 即500M(不支持K,M,G等缩写)。对于处理大数据时,如果内存够用,则设置大点的值,以节约时间。</span><br><span class="line">-n 设定排序方式按short reads的ID排序。默认下是按序列在fasta文件中的顺序(即header)和序列从左往右的位点排序。</span><br></pre></td></tr></table></figure>
<p>例子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ samtools sort abc.bam abc.sort    ###注意 abc.sort 是输出文件的前缀,实际输出是 abc.sort.bam</span><br><span class="line">$ samtools view abc.sort.bam | less -S</span><br></pre></td></tr></table></figure>

<h3 id="3-Merge"><a href="#3-Merge" class="headerlink" title="3. Merge"></a>3. Merge</h3><p>将2个或2个以上的已经sort了的bam文件融合成一个bam文件。融合后的文件不需要则是已经sort过了的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Usage:   samtools merge [-nr] [-h inh.sam] &lt;out.bam&gt; &lt;in1.bam&gt; &lt;in2.bam&gt;[...]</span><br><span class="line">Options: -n       sort by read names</span><br><span class="line"></span><br><span class="line">-r       attach RG tag (inferred from file names)</span><br><span class="line"></span><br><span class="line">-u       uncompressed BAM output</span><br><span class="line"></span><br><span class="line">-f       overwrite the output BAM if exist</span><br><span class="line"></span><br><span class="line">-1       compress level 1</span><br><span class="line"></span><br><span class="line">-R STR   merge file in the specified region STR [all]</span><br><span class="line"></span><br><span class="line">-h FILE  copy the header in FILE to &lt;out.bam&gt; [in1.bam]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Note: Samtools&#39; merge does not reconstruct the @RG dictionary in the header. Users</span><br><span class="line"></span><br><span class="line">must provide the correct header with -h, or uses Picard which properly maintains</span><br><span class="line"></span><br><span class="line">the header dictionary in merging.</span><br></pre></td></tr></table></figure>

<h3 id="4-index"><a href="#4-index" class="headerlink" title="4. index"></a>4. index</h3><p>必须对bam文件进行默认情况下的排序后,才能进行index。否则会报错。</p>
<p>建立索引后将产生后缀为.bai的文件,用于快速的随机处理。很多情况下需要有bai文件的存在,特别是显示序列比对情况下。比如samtool的tview命令就需要;gbrowse2显示reads的比对图形的时候也需要。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Usage: samtools index &lt;in.bam&gt; [out.index]</span><br></pre></td></tr></table></figure>

<p>例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">以下两种命令结果一样</span><br><span class="line">$ samtools index abc.sort.bam</span><br><span class="line">$ samtools index abc.sort.bam abc.sort.bam.bai</span><br></pre></td></tr></table></figure>

<h3 id="5-faidx"><a href="#5-faidx" class="headerlink" title="5. faidx"></a>5. faidx</h3><p>对fasta文件建立索引,生成的索引文件以.fai后缀结尾。该命令也能依据索引文件快速提取fasta文件中的某一条(子)序列。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Usage: samtools faidx &lt;in.bam&gt; [ [...]]</span><br><span class="line">对基因组文件建立索引</span><br><span class="line"></span><br><span class="line">$ samtools faidx genome.fasta</span><br><span class="line"></span><br><span class="line">生成了索引文件genome.fasta.fai,是一个文本文件,分成了5列。第一列是子序列的名称;</span><br><span class="line"></span><br><span class="line">第二列是子序列的长度;个人认为“第三列是序列所在的位置”,因为该数字从上往下逐渐变大,</span><br><span class="line"></span><br><span class="line">最后的数字是genome.fasta文件的大小;第4和5列不知是啥意思。于是通过此文件,可以定</span><br><span class="line"></span><br><span class="line">位子序列在fasta文件在磁盘上的存放位置,直接快速调出子序列。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">由于有索引文件,可以使用以下命令很快从基因组中提取到fasta格式的子序列</span><br><span class="line"></span><br><span class="line">$ samtools faidx genome.fasta scffold_10 &gt; scaffold_10.fasta</span><br></pre></td></tr></table></figure>

<h3 id="6-tview"><a href="#6-tview" class="headerlink" title="6. tview"></a>6. tview</h3><p>tview能直观的显示出reads比对基因组的情况,和基因组浏览器有点类似。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Usage: samtools tview &lt;aln.bam&gt; [ref.fasta]</span><br><span class="line">当给出参考基因组的时候,会在第一排显示参考基因组的序列,否则,第一排全用N表示。</span><br><span class="line"></span><br><span class="line">按下 g ,则提示输入要到达基因组的某一个位点。例子“scaffold_10:1000&quot;表示到达第</span><br><span class="line"></span><br><span class="line">10号scaffold的第1000个碱基位点处。</span><br><span class="line"></span><br><span class="line">使用H(左)J(上)K(下)L(右)移动显示界面。大写字母移动快,小写字母移动慢。</span><br><span class="line"></span><br><span class="line">使用空格建向左快速移动(和 L 类似),使用Backspace键向左快速移动(和 H 类似)。</span><br><span class="line"></span><br><span class="line">Ctrl+H 向左移动1kb碱基距离; Ctrl+L 向右移动1kb碱基距离</span><br><span class="line"></span><br><span class="line">可以用颜色标注比对质量,碱基质量,核苷酸等。3040的碱基质量或比对质量使用白色表示;</span><br><span class="line"></span><br><span class="line">2030黄色;1020绿色;010蓝色。</span><br><span class="line"></span><br><span class="line">使用点号&#39;.&#39;切换显示碱基和点号;使用r切换显示read name等</span><br><span class="line"></span><br><span class="line">还有很多其它的使用说明,具体按 ? 键来查看。</span><br></pre></td></tr></table></figure>

<h3 id="7-flagstat"><a href="#7-flagstat" class="headerlink" title="7. flagstat"></a>7. flagstat</h3><p>给出BAM文件的比对结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Usage: samtools flagstat &lt;in.bam&gt;</span><br><span class="line">$ samtools flagstat example.bam</span><br><span class="line"></span><br><span class="line">11945742 + 0 in total (QC-passed reads + QC-failed reads)</span><br><span class="line"></span><br><span class="line">#总共的reads数</span><br><span class="line"></span><br><span class="line">0 + 0 duplicates</span><br><span class="line"></span><br><span class="line">7536364 + 0 mapped (63.09%:-nan%)</span><br><span class="line"></span><br><span class="line">#总体上reads的匹配率</span><br><span class="line"></span><br><span class="line">11945742 + 0 paired in sequencing</span><br><span class="line"></span><br><span class="line">#有多少reads是属于paired reads</span><br><span class="line"></span><br><span class="line">5972871 + 0 read1</span><br><span class="line"></span><br><span class="line">#reads1中的reads数</span><br><span class="line"></span><br><span class="line">5972871 + 0 read2</span><br><span class="line"></span><br><span class="line">#reads2中的reads数</span><br><span class="line"></span><br><span class="line">6412042 + 0 properly paired (53.68%:-nan%)</span><br><span class="line"></span><br><span class="line">#完美匹配的reads数:比对到同一条参考序列,并且两条reads之间的距离符合设置的阈值</span><br><span class="line"></span><br><span class="line">6899708 + 0 with itself and mate mapped</span><br><span class="line"></span><br><span class="line">#paired reads中两条都比对到参考序列上的reads数</span><br><span class="line"></span><br><span class="line">636656 + 0 singletons (5.33%:-nan%)</span><br><span class="line"></span><br><span class="line">#单独一条匹配到参考序列上的reads数,和上一个相加,则是总的匹配上的reads数。</span><br><span class="line"></span><br><span class="line">469868 + 0 with mate mapped to a different chr</span><br><span class="line"></span><br><span class="line">#paired reads中两条分别比对到两条不同的参考序列的reads数</span><br><span class="line"></span><br><span class="line">243047 + 0 with mate mapped to a different chr (mapQ&gt;&#x3D;5)</span><br></pre></td></tr></table></figure>

<h3 id="7-depth"><a href="#7-depth" class="headerlink" title="7. depth"></a>7. depth</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Usage: bam2depth [-r reg] [-q baseQthres] [-Q mapQthres] [-b in.bed] &lt;in1.bam&gt; [...]</span><br><span class="line">-r 后面跟染色体号(region)</span><br><span class="line"></span><br><span class="line">注意:做depth之前必须做samtools index;</span><br><span class="line"></span><br><span class="line">示例:</span><br><span class="line">samtools depth in.bam  &gt;  out.depth.txt</span><br><span class="line">注意: in.bam 必须经过了排序。</span><br></pre></td></tr></table></figure>

<h3 id="8-其他有用命令"><a href="#8-其他有用命令" class="headerlink" title="8. 其他有用命令"></a>8. 其他有用命令</h3><p>reheader 替换bam文件的头</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ samtools reheader &lt;in.header.sam&gt; &lt;in.bam&gt;</span><br></pre></td></tr></table></figure>
<p>cat 连接多个bam文件,适用于非sorted的bam文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ samtools cat [-h header.sam] [-o out.bam] &lt;in1.bam&gt; &lt;in2.bam&gt; [ ... ]</span><br></pre></td></tr></table></figure>

<p>idxstats 统计一个表格,4列,分别为”序列名,序列长度,比对上的reads数,unmapped reads number”。第4列应该是paired reads中有一端能匹配到该scaffold上,而另外一端不匹配到任何scaffolds上的reads数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ samtools idxstats &lt;aln.bam&gt;</span><br></pre></td></tr></table></figure>

<h3 id="9-将bam文件转换为fastq文件"><a href="#9-将bam文件转换为fastq文件" class="headerlink" title="9. 将bam文件转换为fastq文件"></a>9. 将bam文件转换为fastq文件</h3><p>有时候,我们需要提取出比对到一段参考序列的reads,进行小范围的分析,以利于debug等。这时需要将bam或sam文件转换为fastq格式。<br>该网站提供了一个bam转换为fastq的程序: <a href="http://www.hudsonalpha.org/gsl/information/software/bam2fastq" target="_blank" rel="noopener">http://www.hudsonalpha.org/gsl/information/software/bam2fastq</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ wget http:&#x2F;&#x2F;www.hudsonalpha.org&#x2F;gsl&#x2F;static&#x2F;software&#x2F;bam2fastq-1.1.0.tgz</span><br><span class="line">$ tar zxf bam2fastq-1.1.0.tgz</span><br><span class="line">$ cd bam2fastq-1.1.0</span><br><span class="line">$ make</span><br><span class="line">$ .&#x2F;bam2fastq &lt;in.bam&gt;</span><br></pre></td></tr></table></figure>
<h3 id="10-mpileup"><a href="#10-mpileup" class="headerlink" title="10. mpileup"></a>10. mpileup</h3><p>samtools还有个非常重要的命令mpileup,以前为pileup。该命令用于生成bcf文件,再使用bcftools进行SNP和Indel的分析。bcftools是samtool中附带的软件,在samtools的安装文件夹中可以找到。</p>
<p>最常用的参数有2: -f 来输入有索引文件的fasta参考序列; -g 输出到bcf格式。用法和最简单的例子如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Usage: samtools mpileup [-EBug] [-C capQcoef] [-r reg] [-f in.fa] [-l list] [-M capMapQ] [-Q minBaseQ] [-q minMapQ] in.bam [in2.bam [...]]</span><br><span class="line">$ samtools mpileup -f genome.fasta abc.bam &gt; abc.txt</span><br><span class="line"></span><br><span class="line">$ samtools mpileup -gSDf genome.fasta abc.bam &gt; abc.bcf</span><br><span class="line"></span><br><span class="line">$ samtools mpileup -guSDf genome.fasta abc.bam | </span><br><span class="line"></span><br><span class="line">bcftools view -cvNg - &gt; abc.vcf</span><br></pre></td></tr></table></figure>

<p>mpileup不使用-u或-g参数时,则不生成二进制的bcf文件,而生成一个文本文件(输出到标准输出)。该文本文件统计了参考序列中每个碱基位点的比对情况;该文件每一行代表了参考序列中某一个碱基位点的比对结果。比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">scaffold_1      2841    A       11      ,,,...,....     BHIGDGIJ?FF</span><br><span class="line">scaffold_1      2842    C       12      ,$,,...,....^I. CFGEGEGGCFF+</span><br><span class="line">scaffold_1      2843    G       11      ,,...,.....     FDDDDCD?DD+</span><br><span class="line">scaffold_1      2844    G       11      ,,...,.....     FA?AAAA&lt;AA+</span><br><span class="line">scaffold_1      2845    G       11      ,,...,.....     F656666166*</span><br><span class="line">scaffold_1      2846    A       11      ,,...,.....     (1.1111)11*</span><br><span class="line">scaffold_1      2847    A       11      ,,+9acggtgaag.+9ACGGTGAAT.+9ACGGTGAAG.+9ACGGTGAAG,+9acggtgaag.+9ACGGTGAAG.+9ACGGTGAAG.+9ACGGTGAAG.+9ACGGTGAAG.+9ACGGTGAAG       %.+....-..)</span><br><span class="line">scaffold_1      2848    N       11      agGGGgGGGGG     !!$!!!!!!!!</span><br><span class="line">scaffold_1      2849    A       11      c$,...,.....    !0000000000</span><br><span class="line">scaffold_1      2850    A       10      ,...,.....      353333333</span><br></pre></td></tr></table></figure>

<p>mpileup生成的结果包含6行:参考序列名;位置;参考碱基;比对上的reads数;比对情况;比对上的碱基的质量。其中第5列比较复杂,解释如下:</p>
<p>1 ‘.’代表与参考序列正链匹配。<br>2 ‘,’代表与参考序列负链匹配。<br>3 ‘ATCGN’代表在正链上的不匹配。<br>4 ‘atcgn’代表在负链上的不匹配。<br>5 ‘*’代表模糊碱基<br>6 ‘^’代表匹配的碱基是一个read的开始;’^’后面紧跟的ascii码减去33代表比对质量;这两个符号修饰的是后面的碱基,其后紧跟的碱基(.,ATCGatcgNn)代表该read的第一个碱基。<br>7 ‘$’代表一个read的结束,该符号修饰的是其前面的碱基。<br>8 正则式’+[0-9]+[ACGTNacgtn]+’代表在该位点后插入的碱基;比如上例中在scaffold_1的2847后插入了9个长度的碱基acggtgaag。表明此处极可能是indel。<br>9 正则式’-[0-9]+[ACGTNacgtn]+’代表在该位点后缺失的碱基;</p>
<p>pileup具体的参数如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">输入参数</span><br><span class="line">-6       Assume the quality is in the Illumina 1.3+ encoding. -A Do not skip anomalous read pairs in variant calling. </span><br><span class="line">-B       Disable probabilistic realignment for the computation of base alignment quality (BAQ). BAQ is the Phred-scaled probability of a read base being misaligned. Applying this option greatly helps to reduce false SNPs caused by misalignments. </span><br><span class="line">-b FILE  List of input BAM files, one file per line [null]</span><br><span class="line">-C INT   Coefficient for downgrading mapping quality for reads containing excessive mismatches. Given a read with a phred-scaled probability q of being generated from the mapped position, the new mapping quality is about sqrt((INT-q)&#x2F;INT)*INT. A zero value disables this functionality; if enabled, the recommended value for BWA is 50. [0] </span><br><span class="line">-d INT   At a position, read maximally INT reads per input BAM. [250] </span><br><span class="line">-E       Extended BAQ computation. This option helps sensitivity especially for MNPs, but may hurt specificity a little bit. </span><br><span class="line">-f FILE  The faidx-indexed reference file in the FASTA format. The file can be optionally compressed by razip. [null] </span><br><span class="line">-l FILE  BED or position list file containing a list of regions or sites where pileup or BCF should be generated [null] </span><br><span class="line">-M INT       cap mapping quality at INT [60]</span><br><span class="line">-q INT 	Minimum mapping quality for an alignment to be used [0] </span><br><span class="line">-Q INT 	Minimum base quality for a base to be considered [13]</span><br><span class="line">-r STR 	Only generate pileup in region STR [all sites] </span><br><span class="line">输出参数</span><br><span class="line"></span><br><span class="line">-D 	Output per-sample read depth (require -g&#x2F;-u)</span><br><span class="line"></span><br><span class="line">-g 	Compute genotype likelihoods and output them in the binary call format (BCF).</span><br><span class="line"></span><br><span class="line">-S 	Output per-sample Phred-scaled strand bias P-value (require -g&#x2F;-u)</span><br><span class="line"></span><br><span class="line">-u 	Similar to -g except that the output is uncompressed BCF, which is preferred for piping.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Options for Genotype Likelihood Computation (for -g or -u):</span><br><span class="line"></span><br><span class="line">-e INT 	Phred-scaled gap extension sequencing error probability. Reducing INT leads to longer indels. [20]</span><br><span class="line"></span><br><span class="line">-h INT 	Coefficient for modeling homopolymer errors. Given an l-long homopolymer run, the sequencing error of an indel of size s is modeled as INT*s&#x2F;l. [100]</span><br><span class="line"></span><br><span class="line">-I 	Do not perform INDEL calling</span><br><span class="line"></span><br><span class="line">-L INT 	Skip INDEL calling if the average per-sample depth is above INT. [250]</span><br><span class="line"></span><br><span class="line">-o INT 	Phred-scaled gap open sequencing error probability. Reducing INT leads to more indel calls. [40]</span><br><span class="line"></span><br><span class="line">-P STR 	Comma dilimited list of platforms (determined by @RG-PL) from which indel candidates are obtained. It is recommended to collect indel candidates from sequencing technologies that have low indel error rate such as ILLUMINA. [all]</span><br></pre></td></tr></table></figure>

<h3 id="11-使用bcftools"><a href="#11-使用bcftools" class="headerlink" title="11. 使用bcftools"></a>11. 使用bcftools</h3><p>bcftools和samtools类似,用于处理vcf(variant call format)文件和bcf(binary call format)文件。前者为文本文件,后者为其二进制文件。</p>
<p>bcftools使用简单,最主要的命令是view命令,其次还有index和cat等命令。index和cat命令和samtools中类似。此处主讲使用view命令来进行SNP和Indel calling。该命令的使用方法和例子为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ bcftools view [-AbFGNQSucgv] [-D seqDict] [-l listLoci] [-s listSample] </span><br><span class="line">          [-i gapSNPratio] [-t mutRate] [-p varThres] [-P prior] </span><br><span class="line">          [-1 nGroup1] [-d minFrac] [-U nPerm] [-X permThres] </span><br><span class="line">          [-T trioType] in.bcf [region]</span><br><span class="line">$ bcftools view -cvNg abc.bcf &gt; snp_indel.vcf</span><br></pre></td></tr></table></figure>

<p>生成的结果文件为vcf格式,有10列,分别是:1 参考序列名;2 varianti所在的left-most位置;3 variant的ID(默认未设置,用’.’表示);4 参考序列的allele;5 variant的allele(有多个alleles,则用’,’分隔);6 variant/reference QUALity;7 FILTers applied;8 variant的信息,使用分号隔开;9 FORMAT of the genotype fields, separated by colon (optional); 10 SAMPLE genotypes and per-sample information (optional)。</p>
<p>例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scaffold_1      2847    .       A       AACGGTGAAG      194     .       INDEL;DP&#x3D;11;VDB&#x3D;0.0401;AF1&#x3D;1;AC1&#x3D;2;DP4&#x3D;0,0,8,3;MQ&#x3D;35;FQ&#x3D;-67.5   GT:PL:GQ        1&#x2F;1:235,33,0:63</span><br><span class="line">scaffold_1      3908    .       G       A       111     .       DP&#x3D;13;VDB&#x3D;0.0085;AF1&#x3D;1;AC1&#x3D;2;DP4&#x3D;0,0,5,7;MQ&#x3D;42;FQ&#x3D;-63   GT:PL:GQ        1&#x2F;1:144,36,0:69</span><br><span class="line">scaffold_1      4500    .       A       G       31.5    .       DP&#x3D;8;VDB&#x3D;0.0034;AF1&#x3D;1;AC1&#x3D;2;DP4&#x3D;0,0,1,3;MQ&#x3D;42;FQ&#x3D;-39    GT:PL:GQ        1&#x2F;1:64,12,0:21</span><br><span class="line">scaffold_1      4581    .       TGGNGG  TGG     145     .       INDEL;DP&#x3D;8;VDB&#x3D;0.0308;AF1&#x3D;1;AC1&#x3D;2;DP4&#x3D;0,0,0,8;MQ&#x3D;42;FQ&#x3D;-58.5    GT:PL:GQ        1&#x2F;1:186,24,0:45</span><br><span class="line">scaffold_1      4644    .       G       A       195     .       DP&#x3D;21;VDB&#x3D;0.0198;AF1&#x3D;1;AC1&#x3D;2;DP4&#x3D;0,0,10,10;MQ&#x3D;42;FQ&#x3D;-87 GT:PL:GQ        1&#x2F;1:228,60,0:99</span><br><span class="line">scaffold_1      4827    .       NACAAAGA        NA      4.42    .       INDEL;DP&#x3D;1;AF1&#x3D;1;AC1&#x3D;2;DP4&#x3D;0,0,1,0;MQ&#x3D;40;FQ&#x3D;-37.5       GT:PL:GQ        0&#x2F;1:40,3,0:3</span><br><span class="line">scaffold_1      4854    .       A       G       48      .       DP&#x3D;6;VDB&#x3D;0.0085;AF1&#x3D;1;AC1&#x3D;2;DP4&#x3D;0,0,2,1;MQ&#x3D;41;FQ&#x3D;-36    GT:PL:GQ        1&#x2F;1:80,9,0:16</span><br><span class="line">scaffold_1      5120    .       A       G       85      .       DP&#x3D;8;VDB&#x3D;0.0355;AF1&#x3D;1;AC1&#x3D;2;DP4&#x3D;0,0,5,3;MQ&#x3D;42;FQ&#x3D;-51    GT:PL:GQ        1&#x2F;1:118,24,0:45</span><br></pre></td></tr></table></figure>

<p>第8列中显示了对variants的信息描述,比较重要,其中的 Tag 的描述如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Tag	Format	Description</span><br><span class="line">AF1	double	Max-likelihood estimate of the site allele frequency (AF) of the first ALT allele</span><br><span class="line">DP	int	Raw read depth (without quality filtering)</span><br><span class="line">DP4	int[4]	# high-quality reference forward bases, ref reverse, alternate for and alt rev bases</span><br><span class="line">FQ	int	Consensus quality. Positive: sample genotypes different; negative: otherwise</span><br><span class="line">MQ	int	Root-Mean-Square mapping quality of covering reads</span><br><span class="line">PC2	int[2]	Phred probability of AF in group1 samples being larger (,smaller) than in group2</span><br><span class="line">PCHI2	double	Posterior weighted chi^2 P-value between group1 and group2 samples</span><br><span class="line">PV4	double[4]	P-value for strand bias, baseQ bias, mapQ bias and tail distance bias</span><br><span class="line">QCHI2	int	Phred-scaled PCHI2</span><br><span class="line">RP	int	# permutations yielding a smaller PCHI2</span><br><span class="line">CLR	int	Phred log ratio of genotype likelihoods with and without the trio&#x2F;pair constraint</span><br><span class="line">UGT	string	Most probable genotype configuration without the trio constraint</span><br><span class="line">CGT	string	Most probable configuration with the trio constraint</span><br></pre></td></tr></table></figure>

<p>bcftools view 的具体参数如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Input&#x2F;Output Options:</span><br><span class="line">-A 	Retain all possible alternate alleles at variant sites. By default, the view command discards unlikely alleles.</span><br><span class="line">-b 	Output in the BCF format. The default is VCF.</span><br><span class="line">-D FILE Sequence dictionary (list of chromosome names) for VCF-&gt;BCF conversion [null]</span><br><span class="line">-F 	Indicate PL is generated by r921 or before (ordering is different).</span><br><span class="line">-G 	Suppress all individual genotype information.</span><br><span class="line">-l FILE List of sites at which information are outputted [all sites]</span><br><span class="line">-N 	Skip sites where the REF field is not A&#x2F;C&#x2F;G&#x2F;T</span><br><span class="line">-Q 	Output the QCALL likelihood format</span><br><span class="line">-s FILE List of samples to use. The first column in the input gives the sample names and the second gives the ploidy, which can only be 1 or 2. When the 2nd column is absent, the sample ploidy is assumed to be 2. In the output, the ordering of samples will be identical to the one in FILE. [null]</span><br><span class="line">-S 	The input is VCF instead of BCF.</span><br><span class="line">-u 	Uncompressed BCF output (force -b). </span><br><span class="line">Consensus&#x2F;Variant Calling Options:</span><br><span class="line"></span><br><span class="line">-c 	Call variants using Bayesian inference. This option automatically invokes option -e.</span><br><span class="line"></span><br><span class="line">-d FLOAT When -v is in use, skip loci where the fraction of samples covered by reads is below FLOAT. [0]</span><br><span class="line"></span><br><span class="line">        当有多个sample用于variants calling时,比如多个转录组数据或多个重测序</span><br><span class="line"></span><br><span class="line">        数据需要比对到参考基因组上,设置该值,表明至少有该&lt;float 01&gt;比例的</span><br><span class="line"></span><br><span class="line">        samples在该位点都有覆盖才计算入variant.所以对于只有一个sample的情况</span><br><span class="line"></span><br><span class="line">        下,该值设置在01之间没有意义,大于1则得不到任何结果。</span><br><span class="line"></span><br><span class="line">-e 	Perform max-likelihood inference only, including estimating the site allele frequency, testing Hardy-Weinberg equlibrium and testing associations with LRT.</span><br><span class="line"></span><br><span class="line">-g 	Call per-sample genotypes at variant sites (force -c)</span><br><span class="line"></span><br><span class="line">-i FLOAT Ratio of INDEL-to-SNP mutation rate [0.15]</span><br><span class="line"></span><br><span class="line">-p FLOAT A site is considered to be a variant if P(ref|D)</span><br><span class="line"></span><br><span class="line">-t FLOAT Scaled muttion rate for variant calling [0.001]</span><br><span class="line"></span><br><span class="line">-T STR 	Enable pair&#x2F;trio calling. For trio calling, option -s is usually needed to be applied to configure the trio members and their ordering. In the file supplied to the option -s, the first sample must be the child, the second the father and the third the mother. The valid values of STR are ‘pair’, ‘trioauto’, ‘trioxd’ and ‘trioxs’, where ‘pair’ calls differences between two input samples, and ‘trioxd’ (‘trioxs’) specifies that the input is from the X chromosome non-PAR regions and the child is a female (male). [null]</span><br><span class="line"></span><br><span class="line">-v 	Output variant sites only (force -c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Contrast Calling and Association Test Options:</span><br><span class="line"></span><br><span class="line">-1 INT 	Number of group-1 samples. This option is used for dividing the samples into two groups for contrast SNP calling or association test. When this option is in use, the following VCF INFO will be outputted: PC2, PCHI2 and QCHI2. [0]</span><br><span class="line"></span><br><span class="line">-U INT 	Number of permutations for association test (effective only with -1) [0]</span><br><span class="line"></span><br><span class="line">-X FLOAT Only perform permutations for P(chi^2)</span><br></pre></td></tr></table></figure>

<p>使用bcftools得到variant calling结果后。需要对结果再次进行过滤。主要依据比对结果中第8列信息。其中的 DP4 一行尤为重要,提供了4个数据:1 比对结果和正链一致的reads数、2 比对结果和负链一致的reads数、3 比对结果在正链的variant上的reads数、4 比对结果在负链的variant上的reads数。可以设定 (value3 + value4)大于某一阈值,才算是variant。比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ perl -ne &#39;print $_ if &#x2F;DP4&#x3D;(\d+),(\d+),(\d+),(\d+)&#x2F; &amp;&amp; ($3+$4)&gt;&#x3D;10 &amp;&amp; ($3+$4)&#x2F;($1+$2+$3+$4)&gt;&#x3D;0.8&#39; snp_indel.vcf &gt; snp_indel.final.vcf</span><br></pre></td></tr></table></figure>

<h3 id="12-samtools-rmdup"><a href="#12-samtools-rmdup" class="headerlink" title="12. samtools rmdup"></a>12. samtools rmdup</h3><p>NGS上机测序前需要进行PCR一步,使一个模板扩增出一簇,从而在上机测序的时候表现出为1个点,即一个reads。若一个模板扩增出了多簇,结 果得到了多个reads,这些reads的坐标(coordinates)是相近的。在进行了reads比对后需要将这些由PCR duplicates获得的reads去掉,并只保留最高比对质量的read。使用rmdup命令即可完成.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Usage:  samtools rmdup [-sS]  </span><br><span class="line">-s 对single-end reads。默认情况下,只对paired-end reads</span><br><span class="line">-S 将Paired-end reads作为single-end reads处理。</span><br><span class="line">$ samtools input.sorted.bam output.bam</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sam 和 bam 格式转换</span><br><span class="line">BAM转换为SAM</span><br><span class="line">samtools view -h -o out.sam out.bam </span><br><span class="line">SAM转换为BAM</span><br><span class="line">samtools view -bS out.sam &gt;out.bam</span><br><span class="line">-b 意思使输出使BAM format</span><br><span class="line">-S 意思使输入使SAM,如果@SQ 缺剩, 要写-t </span><br><span class="line">所以如果没有@SQ</span><br><span class="line">samtools faidx ref.fa</span><br><span class="line">samtools view -bt ref.fa.fai out.sam &gt; out.bam</span><br></pre></td></tr></table></figure>

<p>REF:<br><a href="http://www.chenlianfu.com/?p=1399" target="_blank" rel="noopener">http://www.chenlianfu.com/?p=1399</a><br><a href="http://en.wikipedia.org/wiki/SAMtools" target="_blank" rel="noopener">http://en.wikipedia.org/wiki/SAMtools</a><br><a href="http://www.htslib.org/doc/samtools-1.1.html" target="_blank" rel="noopener">http://www.htslib.org/doc/samtools-1.1.html</a><br><a href="http://sourceforge.net/projects/samtools/files/" target="_blank" rel="noopener">http://sourceforge.net/projects/samtools/files/</a><br><a href="http://samtools.sourceforge.net/samtools.shtml" target="_blank" rel="noopener">http://samtools.sourceforge.net/samtools.shtml</a></p>
</div><div class="post-copyright"><blockquote><p>原文作者: Billy &amp; Barney</p><p>原文链接: <a href="https://liangbilin.github.io/2019/06/16/Billy--软件samtools教程（转载）/">https://liangbilin.github.io/2019/06/16/Billy--软件samtools教程（转载）/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/tags/%E4%BA%8C%E4%BB%A3%E6%B5%8B%E5%BA%8F/">二代测序</a><a href="/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E7%A8%8B/">软件教程</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2019/06/16/Billy--%E5%88%A9%E7%94%A8AutoDOCK%E8%BF%9B%E8%A1%8C%E5%88%86%E5%AD%90%E5%AF%B9%E6%8E%A5/" class="pre">利用AutoDOCK进行分子对接</a><a href="/2019/06/02/Billy--Markdown%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="next">Markdown 学习笔记</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-View"><span class="toc-text">1. View</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Sort"><span class="toc-text">2. Sort</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Merge"><span class="toc-text">3. Merge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-index"><span class="toc-text">4. index</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-faidx"><span class="toc-text">5. faidx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-tview"><span class="toc-text">6. tview</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-flagstat"><span class="toc-text">7. flagstat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-depth"><span class="toc-text">7. depth</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-其他有用命令"><span class="toc-text">8. 其他有用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-将bam文件转换为fastq文件"><span class="toc-text">9. 将bam文件转换为fastq文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-mpileup"><span class="toc-text">10. mpileup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-使用bcftools"><span class="toc-text">11. 使用bcftools</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-samtools-rmdup"><span class="toc-text">12. samtools rmdup</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/01/20/Billy--Nanopore%20Sequencing%20%E6%A6%82%E8%BF%B0/">组学数据分析中各种 Gene ID</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/15/Barnery--%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%B8%8E%E9%97%AD%E5%8C%85/">作用域与闭包</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/13/Billy--%E8%9B%8B%E7%99%BD%E7%BB%93%E6%9E%84%E5%90%8C%E6%BA%90%E5%BB%BA%E6%A8%A1/">蛋白质结构同源建模</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/10/Billy--R%E8%AF%AD%E8%A8%80%E7%9A%84Jupyter%20notebook%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">R语言的Jupyter notebook环境搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/07/Barnery--window%E5%AF%B9%E8%B1%A1/">window对象</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/05/Barnery--JS%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6/">JS中的事件机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/05/BIlly--%E8%82%BF%E7%98%A4%E6%96%B0%E7%94%9F%E6%8A%97%E5%8E%9F/">肿瘤新生抗原</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/30/Barnery--JS%E4%B8%AD%E7%9A%84%E5%80%BC%E7%B1%BB%E5%9E%8B/">JS中的值类型</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/25/Billy--Jupyter%20notebook%20server/">Jupyter notebook server 搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/26/Billy--%E8%A1%A8%E8%A7%82%E7%BB%84%E6%9F%93%E8%89%B2%E4%BD%93%E5%BC%80%E6%94%BE%E5%8C%BA%E5%9F%9F%E5%88%86%E6%9E%90%E2%80%94ATAC-seq/">表观组染色体开放区域分析:ATAC-seq</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Barnery/">Barnery</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Barney/">Barney</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Billy/">Billy</a><span class="category-list-count">16</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/%E8%A1%A8%E8%A7%82%E7%BB%84/" style="font-size: 15px;">表观组</a> <a href="/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/" style="font-size: 15px;">神经网络</a> <a href="/tags/%E4%BA%8C%E4%BB%A3%E6%B5%8B%E5%BA%8F/" style="font-size: 15px;">二代测序</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" style="font-size: 15px;">编程语言</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%BE%85%E5%8A%A9%E8%8D%AF%E7%89%A9%E8%AE%BE%E8%AE%A1/" style="font-size: 15px;">计算机辅助药物设计</a> <a href="/tags/%E8%BD%AF%E4%BB%B6%E6%95%99%E7%A8%8B/" style="font-size: 15px;">软件教程</a> <a href="/tags/%E7%BA%B3%E7%B1%B3%E5%AD%94%E6%B5%8B%E5%BA%8F/" style="font-size: 15px;">纳米孔测序</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/%E8%BD%AC%E5%BD%95%E7%BB%84/" style="font-size: 15px;">转录组</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/%E8%82%BF%E7%98%A4/" style="font-size: 15px;">肿瘤</a> <a href="/tags/%E5%8F%98%E5%BC%82%E4%BD%8D%E7%82%B9/" style="font-size: 15px;">变异位点</a> <a href="/tags/JS/" style="font-size: 15px;">JS</a> <a href="/tags/Nanopore-Sequencing/" style="font-size: 15px;">Nanopore Sequencing</a> <a href="/tags/%E8%9B%8B%E7%99%BD%E7%BB%93%E6%9E%84/" style="font-size: 15px;">蛋白结构</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">13</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://asia.ensembl.org/index.html" title="ensembl" target="_blank">ensembl</a><ul></ul><a href="https://sci-hub.tw/" title="sci-hub" target="_blank">sci-hub</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Billy &amp; Barney.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/" target="_blank" rel="noopener"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>